import{_ as ee,g as L,n as te,i as B,h as $,t as re,k as se,l as K,m as N,s as ne,o as ie,p as I,S as ae,R as Q,q as oe,v as ue,w as ce,c as S,a as V,b as h,j as R,F as le,d as de,r as q,x,y as z,z as he,u as fe}from"./index-8d8db44b.js";import{B as H}from"./index-8a9325c5.js";import{I as pe,P as ve,M as ye}from"./index-e003e191.js";import{B as T,S as ge}from"./building-25e11633.js";import{u as me}from"./useInput-491b3e8c.js";var Re=function(r){ee(a,r);function a(i,t){var e;return e=r.call(this)||this,e.client=i,e.options=t,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(t),e}var s=a.prototype;return s.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},s.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),D(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},s.onUnsubscribe=function(){this.listeners.length||this.destroy()},s.shouldFetchOnReconnect=function(){return j(this.currentQuery,this.options,this.options.refetchOnReconnect)},s.shouldFetchOnWindowFocus=function(){return j(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},s.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},s.setOptions=function(t,e){var o=this.options,n=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(t),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=o.queryKey),this.updateQuery();var c=this.hasListeners();c&&W(this.currentQuery,n,this.options,o)&&this.executeFetch(),this.updateResult(e),c&&(this.currentQuery!==n||this.options.enabled!==o.enabled||this.options.staleTime!==o.staleTime)&&this.updateStaleTimeout();var u=this.computeRefetchInterval();c&&(this.currentQuery!==n||this.options.enabled!==o.enabled||u!==this.currentRefetchInterval)&&this.updateRefetchInterval(u)},s.getOptimisticResult=function(t){var e=this.client.defaultQueryObserverOptions(t),o=this.client.getQueryCache().build(this.client,e);return this.createResult(o,e)},s.getCurrentResult=function(){return this.currentResult},s.trackResult=function(t,e){var o=this,n={},c=function(d){o.trackedProps.includes(d)||o.trackedProps.push(d)};return Object.keys(t).forEach(function(u){Object.defineProperty(n,u,{configurable:!1,enumerable:!0,get:function(){return c(u),t[u]}})}),(e.useErrorBoundary||e.suspense)&&c("error"),n},s.getNextResult=function(t){var e=this;return new Promise(function(o,n){var c=e.subscribe(function(u){u.isFetching||(c(),u.isError&&(t!=null&&t.throwOnError)?n(u.error):o(u))})})},s.getCurrentQuery=function(){return this.currentQuery},s.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},s.refetch=function(t){return this.fetch(L({},t,{meta:{refetchPage:t==null?void 0:t.refetchPage}}))},s.fetchOptimistic=function(t){var e=this,o=this.client.defaultQueryObserverOptions(t),n=this.client.getQueryCache().build(this.client,o);return n.fetch().then(function(){return e.createResult(n,o)})},s.fetch=function(t){var e=this;return this.executeFetch(t).then(function(){return e.updateResult(),e.currentResult})},s.executeFetch=function(t){this.updateQuery();var e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(te)),e},s.updateStaleTimeout=function(){var t=this;if(this.clearStaleTimeout(),!(B||this.currentResult.isStale||!$(this.options.staleTime))){var e=re(this.currentResult.dataUpdatedAt,this.options.staleTime),o=e+1;this.staleTimeoutId=setTimeout(function(){t.currentResult.isStale||t.updateResult()},o)}},s.computeRefetchInterval=function(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1},s.updateRefetchInterval=function(t){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=t,!(B||this.options.enabled===!1||!$(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||se.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},s.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},s.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},s.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},s.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},s.createResult=function(t,e){var o=this.currentQuery,n=this.options,c=this.currentResult,u=this.currentResultState,d=this.currentResultOptions,v=t!==o,f=v?t.state:this.currentQueryInitialState,b=v?this.currentResult:this.previousQueryResult,l=t.state,g=l.dataUpdatedAt,C=l.error,U=l.errorUpdatedAt,_=l.isFetching,p=l.status,M=!1,P=!1,y;if(e.optimisticResults){var A=this.hasListeners(),J=!A&&D(t,e),X=A&&W(t,o,e,n);(J||X)&&(_=!0,g||(p="loading"))}if(e.keepPreviousData&&!l.dataUpdateCount&&(b!=null&&b.isSuccess)&&p!=="error")y=b.data,g=b.dataUpdatedAt,p=b.status,M=!0;else if(e.select&&typeof l.data<"u")if(c&&l.data===(u==null?void 0:u.data)&&e.select===this.selectFn)y=this.selectResult;else try{this.selectFn=e.select,y=e.select(l.data),e.structuralSharing!==!1&&(y=K(c==null?void 0:c.data,y)),this.selectResult=y,this.selectError=null}catch(E){N().error(E),this.selectError=E}else y=l.data;if(typeof e.placeholderData<"u"&&typeof y>"u"&&(p==="loading"||p==="idle")){var O;if(c!=null&&c.isPlaceholderData&&e.placeholderData===(d==null?void 0:d.placeholderData))O=c.data;else if(O=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof O<"u")try{O=e.select(O),e.structuralSharing!==!1&&(O=K(c==null?void 0:c.data,O)),this.selectError=null}catch(E){N().error(E),this.selectError=E}typeof O<"u"&&(p="success",y=O,P=!0)}this.selectError&&(C=this.selectError,y=this.selectResult,U=Date.now(),p="error");var Z={status:p,isLoading:p==="loading",isSuccess:p==="success",isError:p==="error",isIdle:p==="idle",data:y,dataUpdatedAt:g,error:C,errorUpdatedAt:U,failureCount:l.fetchFailureCount,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>f.dataUpdateCount||l.errorUpdateCount>f.errorUpdateCount,isFetching:_,isRefetching:_&&p!=="loading",isLoadingError:p==="error"&&l.dataUpdatedAt===0,isPlaceholderData:P,isPreviousData:M,isRefetchError:p==="error"&&l.dataUpdatedAt!==0,isStale:w(t,e),refetch:this.refetch,remove:this.remove};return Z},s.shouldNotifyListeners=function(t,e){if(!e)return!0;var o=this.options,n=o.notifyOnChangeProps,c=o.notifyOnChangePropsExclusions;if(!n&&!c||n==="tracked"&&!this.trackedProps.length)return!0;var u=n==="tracked"?this.trackedProps:n;return Object.keys(t).some(function(d){var v=d,f=t[v]!==e[v],b=u==null?void 0:u.some(function(g){return g===d}),l=c==null?void 0:c.some(function(g){return g===d});return f&&!l&&(!u||b)})},s.updateResult=function(t){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!ne(this.currentResult,e)){var o={cache:!0};(t==null?void 0:t.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(o.listeners=!0),this.notify(L({},o,t))}},s.updateQuery=function(){var t=this.client.getQueryCache().build(this.client,this.options);if(t!==this.currentQuery){var e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}},s.onQueryUpdate=function(t){var e={};t.type==="success"?e.onSuccess=!0:t.type==="error"&&!ie(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},s.notify=function(t){var e=this;I.batch(function(){t.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):t.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),t.listeners&&e.listeners.forEach(function(o){o(e.currentResult)}),t.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},a}(ae);function be(r,a){return a.enabled!==!1&&!r.state.dataUpdatedAt&&!(r.state.status==="error"&&a.retryOnMount===!1)}function D(r,a){return be(r,a)||r.state.dataUpdatedAt>0&&j(r,a,a.refetchOnMount)}function j(r,a,s){if(a.enabled!==!1){var i=typeof s=="function"?s(r):s;return i==="always"||i!==!1&&w(r,a)}return!1}function W(r,a,s,i){return s.enabled!==!1&&(r!==a||i.enabled===!1)&&(!s.suspense||r.state.status!=="error")&&w(r,s)}function w(r,a){return r.isStaleByTime(a.staleTime)}function Oe(){var r=!1;return{clearReset:function(){r=!1},reset:function(){r=!0},isReset:function(){return r}}}var Se=Q.createContext(Oe()),Qe=function(){return Q.useContext(Se)};function Ee(r,a){var s=Q.useRef(!1),i=Q.useState(0),t=i[1],e=oe(),o=Qe(),n=e.defaultQueryObserverOptions(r);n.optimisticResults=!0,n.onError&&(n.onError=I.batchCalls(n.onError)),n.onSuccess&&(n.onSuccess=I.batchCalls(n.onSuccess)),n.onSettled&&(n.onSettled=I.batchCalls(n.onSettled)),n.suspense&&(typeof n.staleTime!="number"&&(n.staleTime=1e3),n.cacheTime===0&&(n.cacheTime=1)),(n.suspense||n.useErrorBoundary)&&(o.isReset()||(n.retryOnMount=!1));var c=Q.useState(function(){return new a(e,n)}),u=c[0],d=u.getOptimisticResult(n);if(Q.useEffect(function(){s.current=!0,o.clearReset();var v=u.subscribe(I.batchCalls(function(){s.current&&t(function(f){return f+1})}));return u.updateResult(),function(){s.current=!1,v()}},[o,u]),Q.useEffect(function(){u.setOptions(n,{listeners:!1})},[n,u]),n.suspense&&d.isLoading)throw u.fetchOptimistic(n).then(function(v){var f=v.data;n.onSuccess==null||n.onSuccess(f),n.onSettled==null||n.onSettled(f,null)}).catch(function(v){o.clearReset(),n.onError==null||n.onError(v),n.onSettled==null||n.onSettled(void 0,v)});if(d.isError&&!o.isReset()&&!d.isFetching&&ue(n.suspense,n.useErrorBoundary,[d.error,u.getCurrentQuery()]))throw d.error;return n.notifyOnChangeProps==="tracked"&&(d=u.trackResult(d,n)),d}function k(r,a,s){var i=ce(r,a,s);return Ee(i,Re)}const Ie=S("section",{target:"e1a6068d4"})("display:flex;flex-direction:column;justify-content:center;padding:0 30px;",({theme:r})=>V("min-height:calc(var(--vh, 1vh) * 100 - ",r.layouts.fixedHeight,");",""),";"),Ce=S("div",{target:"e1a6068d3"})("display:grid;grid-template-rows:350px 1fr;width:100%;height:450px;background-color:",({theme:r})=>r.colors.white_300,";border:1px solid ",({theme:r})=>r.colors.light_grey_100,";border-radius:5px;margin-bottom:30px;"),xe=S("div",{target:"e1a6068d1"})("display:flex;flex-direction:column;justify-content:space-evenly;align-items:flex-start;width:100%;padding:0 10px;border-top:1px solid ",({theme:r})=>r.colors.light_grey_100,";background-color:",({theme:r})=>r.colors.background_2,";&>div{display:flex;align-items:center;width:100%;height:24px;&:last-of-type{padding:0 10px;}}"),_e=S("hr",{target:"e1a6068d0"})("width:100%;height:1px;padding-left:10px;border:0;background:",({theme:r})=>r.colors.light_grey_200,";"),Te=r=>{const{majorInfo:a,handleInput:s,handleApplyButton:i}=r;if(!a)return h("span",{children:"추가 조건이 없습니다!"});const t=Object.entries(a).filter(([,e])=>e);return R(le,{children:[t.map(([e,o])=>R("div",{children:[h("span",{children:o}),h("input",{placeholder:"입력해라",onChange:s})]},e)),h(H,{variant:"contained",onClick:i,children:"신청"})]})},G={not_building:"건물을 선택해주세요.",not_login:"로그인 후 사용할 수 있습니다!"},Fe=r=>{const{me:a,value:s,total:i,applyCount:t}=r,e=de();if(!a||!i){const n=a?G.not_building:G.not_login;return R(m.Root,{children:[h(pe,{iconName:"nothing",size:"100",color:e.colors.grey_200,hasCursor:!1}),h("span",{style:{color:e.colors.grey_200},children:n})]})}const o=Math.ceil(t/i*100);return R(m.Root,{children:[h(m.GradientWrapper,{children:R(m.Building,{grd:o>100?100:o,children:[h(m.Floor,{}),h(m.Floor,{}),h(m.Floor,{}),h(m.Floor,{}),h(m.Floor,{})]})}),R(m.Title,{children:[s," ( ",t," / ",i," )"]})]})},m={Root:S("div",{target:"e166tayl4"})({name:"l768v7",styles:"display:flex;flex-direction:column;justify-content:center;align-items:center;gap:20px;width:100%"}),Building:S("div",{target:"e166tayl3"})("display:grid;grid-template-rows:repeat(5, 1fr);border-radius:5px;",({grd:r})=>V("height:",100-r,"%;background:white;",""),";"),GradientWrapper:S("div",{target:"e166tayl2"})({name:"1ncgd1x",styles:"background-color:#2cb67d"}),Floor:S("div",{target:"e166tayl1"})("width:100px;height:50px;background-color:transparent;border:5px solid ",({theme:r})=>r.colors.light_grey_200,";"),Title:S("h1",{target:"e166tayl0"})("")},F={학과:0,프랑스어학부:1,독일어과:2,노어과:3,스페인어과:4,이탈리아어과:5,포르투갈어과:6,네덜란드어과:7,스칸디나비아어과:8,말레이인도네시아어과:9,아랍어과:10,태국어과:11,베트남어과:12,인도어과:13,터키아제르바이잔어과:14,페르시아어이란학과:15,몽골어과:16,ELLT학과:17,영미문학문화학과:18,EICC학과:19,중국학대학:20,일본학대학:21,정치외교학과:22,행정학과:23,미디어커뮤니케이션학부:24,영어교육과:25,한국어교육과:26,프랑스어교육과:27,독일어교육과:28,중국어교육과:29,상경대학:30,경영학부:31,국제학부:32,LD학부:33},je=(r=!1)=>{const[a,s]=q.useState(r);return{open:a,handleOpen:()=>s(!a),setOpen:s}},ke=async r=>{const{major:a,building_id:s}=r,{data:i}=await x.get(`locker?major=${a}&building_id=${s}`);return i},we=async r=>{const{major:a,building_id:s}=r,{data:i}=await x.get(`apply?major=${a}&building_id=${s}`);return i},Ue=async r=>{const{data:a}=await x.post("apply/",r);return a},Y={apply:"apply",locker:"locker"},Me=r=>{const a=Object.values(r),{data:s}=k([Y.locker,"locker-counts",...a],()=>ke(r),{refetchOnWindowFocus:!1,refetchOnMount:!1}),{data:i,refetch:t}=k([Y.apply,"applicant",...a],()=>we(r),{refetchOnWindowFocus:!1,refetchOnMount:!1});return{data:{apply:i,lockerCounts:s},refetch:t}},Pe=()=>{const{createToastMessage:r}=z();return he(s=>Ue(s),{onSuccess:()=>{r("신청 완료 !","success")},onError:()=>{r("다시 시도해주세요.","error")}})},Ae=async r=>{const a=`/major/${r}`,{data:s}=await x.get(a);return s},Le={major:"major"},Be=(r,a)=>{const{data:s}=k([Le.major,r],()=>Ae(r),{select:i=>{const{priority_first:t,priority_second:e,priority_third:o}=i;return a?{priority_first:t,priority_second:e,priority_third:o}:i}});return{majorInfo:s}},Ge=()=>{const[r,a]=q.useState("건물"),{value:s,handleValue:i}=me({}),{me:t}=fe(),{mutate:e}=Pe(),{majorInfo:o}=Be(F[t.major],!0),n=C=>a(C.currentTarget.innerText),{open:c,handleOpen:u}=je(),{createToastMessage:d}=z(),{data:{apply:v,lockerCounts:f},refetch:b}=Me({major:F[t.major],building_id:T[r]}),l=()=>{if(!t)return d("로그인 후 사용해주세요!","error");if(!(f!=null&&f.length))return d("해당 건물에는 사물함이 없습니다!","error");o||g(),u()},g=()=>{e({building_id:T[r],major:F[t.major],user:t.id,...s},{onSuccess:b}),l()};return R(ve,{children:[R(Ie,{children:[R(Ce,{children:[h(Fe,{me:t,value:r,total:f?f.length:void 0,applyCount:v.length}),R(xe,{children:[h(ge,{value:r,handleChange:n,list:Object.keys(T).slice(1)}),h(_e,{}),h("div",{children:t.major||"학과"})]})]}),h(H,{variant:"contained",onClick:l,children:"신청하기"})]}),h(ye,{title:"학과별 조건 입력",open:c,onClose:l,children:t&&h(Te,{majorInfo:o,handleInput:i,handleApplyButton:g})})]})};export{Ge as default};
