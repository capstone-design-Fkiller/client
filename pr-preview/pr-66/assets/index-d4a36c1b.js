import{c as o,a as M,j as t,r as u,b as p,L as T,F as D,i as _,f as b,g as C,h as L,k,u as j,d as A,P as F}from"./index-9a7d9b15.js";import{Y as z,I as H,M as f,B as N,P as Y}from"./index-6a342ddd.js";import{a as B}from"./building-925df4bd.js";import{P as y,a as Q}from"./index-198839cf.js";import{u as O}from"./major-bc22ed8b.js";const $=o("div",{target:"e1hp0tas2"})("display:flex;justify-content:center;flex-direction:column;align-items:center;padding:0 30px;",({theme:e})=>M("min-height:calc(var(--vh, 1vh) * 100 - ",e.layouts.fixedHeight,");",""),";"),q=o("h1",{target:"e1hp0tas1"})("font-size:25px;font-weight:bold;margin-bottom:10px;color:",({theme:e})=>e.colors.primary_300,";"),x=o("div",{target:"e1hp0tas0"})("font-size:14px;font-weight:400;text-align:center;color:",({theme:e})=>e.colors.grey_300,";"),G=o("table",{target:"e1o1mye43"})("width:100%;margin-top:15px;border-collapse:collapse;& tr>td,& tr>th{padding:10px 5px;white-space:nowrap;&:first-of-type{padding-left:10px;}}& tbody tr{border-bottom:1px solid ",({theme:e})=>e.colors.light_grey_100,";}"),J=o("h1",{target:"e1o1mye42"})({name:"lykxvs",styles:"display:flex;font-size:18px;justify-content:center;margin:150px 0"}),K=({contents:e,handleDelete:n})=>{const s=r=>r===null?"-":typeof r=="boolean"?r?"O":"X":r,a=r=>{confirm("정말 삭제하시겠습니까?")&&n(r)};return t("tbody",{children:e.map(r=>t(u.Fragment,{children:p(i.Row,{children:[t(i.Item,{children:r.user}),t(i.Item,{children:s(r.priority_1_answer)}),t(i.Item,{children:s(r.priority_2_answer)}),t(i.Item,{children:s(r.priority_3_answer)}),t(i.Item,{children:z(r.created_at,!0)}),t(i.Item,{children:B(r.building_id)}),t(i.IconItem,{onClick:()=>a(r.id),children:t(H,{iconName:"trashcan",size:"18"})})]})},r.id))})},i={Row:o("tr",{target:"efwokpf2"})("font-size:13px;padding:10px;width:100%;transition:0.1s color ease-in-out;&:hover{background-color:",({theme:e})=>e.colors.light_grey_100,";}"),Item:o("td",{target:"efwokpf1"})({name:"7lr3li",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center"}),IconItem:o("td",{target:"efwokpf0"})("display:flex;flex-direction:column;align-items:center;cursor:pointer;&:hover svg path{stroke:",({theme:e})=>e.colors.error_100,";}")},U=e=>{const{headers:n}=e;return t(v.Head,{children:t("tr",{children:n.map(s=>t(v.Item,{children:s},s))})})},v={Head:o("thead",{target:"ens05cg1"})("width:100%;font-size:15px;font-weight:bold;background-color:",({theme:e})=>e.colors.primary_200,";border-radius:5px;"),Item:o("th",{target:"ens05cg0"})({name:"7lr3li",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center"})},X=["학번","1st","2nd","3rd","신청시간","건물","삭제"],V=e=>{const{currentPage:n,setCurrentPage:s,currentSort:a,handleDelete:r,isLoading:c,sorts:h}=e;return c?t(T,{}):h&&!h.length?t(J,{children:"사물함 신청자가 없습니다."}):p(D,{children:[p(G,{children:[t(U,{headers:X}),t(K,{contents:(a==null?void 0:a.slice((n-1)*y,n*y))||[],handleDelete:r})]}),t(Q,{currentPage:n,totalItems:(a==null?void 0:a.length)||0,itemsPerPage:y,setState:s})]})},W=async e=>{const n=e||0,{data:s}=await _.get(`sort/${n}`);return s},Z=async(e,n)=>{const s=e||0,{data:a}=await _.post(`assign/${s}`,n);return a},I={sort:"sort",assign:"assignResult"},ee=e=>{const{createToastMessage:n}=b(),{data:s,isLoading:a}=C(I.sort,()=>W(e),{onError:()=>{n("오류가 발생했습니다.","error")},staleTime:6e4});return{data:s,isLoading:a}},te=()=>{const{createToastMessage:e}=b(),n=L();return k(({major:a,sortResult:r})=>Z(a,r),{onSuccess:()=>{e("배정 확정 완료!","success"),n.invalidateQueries([I.assign])},onError:()=>{e("다시 시도해주세요.","error")}})},pe=()=>{const{me:e}=j();if(!e)throw new Error;const n=A(),{data:s,isLoading:a}=ee(f[(e==null?void 0:e.major)??"학과"]),{mutate:r}=te(),[c,h]=u.useState(s),[R,S]=u.useState(1),{majorInfo:l}=O(f[e.major],!1),[re,E]=u.useState(!1),w=()=>{if(!(l!=null&&l.apply_end_date))throw new Error;if(new Date(l==null?void 0:l.apply_end_date)<new Date)return!0};return t(Y,{children:p($,{children:[t(q,{children:"사물함 배정 예상 결과"}),p(x,{children:[t("p",{children:"사물함 신청이 끝나면 배정 확정 버튼이 활성화됩니다."}),t("p",{children:"페이지를 나가면 변경사항이 모두 사라집니다."})]}),t(V,{isLoading:a,sorts:s,currentSort:c,currentPage:R,setCurrentPage:S,handleDelete:g=>{w()||h(d=>d==null?void 0:d.filter(P=>P.id!==g))}}),t(x,{children:t("p",{children:"배정 확정 버튼을 누른 이후엔 변경이 불가합니다!!"})}),t(N,{variant:"contained",color:"primary",onClick:()=>{if(w())return;const m=c==null?void 0:c.map(d=>d.id);r({major:f[e.major],sortResult:{list:m||[]}},{onSuccess:()=>{E(!0),n(F.MAIN)}})},children:"배정 확정하기"})]})})};export{pe as default};
